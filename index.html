<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      font {
        font-family: Roboto;
        font-size: 14px;
        line-height: 20px;
      }
      #footer {
        padding: 10px;
        margin: 10px 0;
        cursor: pointer;
        background-color: tomato;
        color: white;
        display: inline-block;
      }
      #footer-display,
      #footer-source {
        border: 1px solid #ededed;
        padding: 10px;
        font-size: 14px;
        line-height: 20px;
      }
      #footer-display {
        font-family: Roboto;
      }
      #footer-source {
        font-family: Courier New;
      }
    </style>
  </head>
  <body>
    <form id="footer-select" autocomplete="on" onsubmit="dummySubmit(); return false;">
      <section id="products">
        <font>Select product : </font>
        <select name="products" id="products-select">
          <option value="" disabled selected>Select your product</option>
          <? for (var i = 0; i < data.products.length; i++) { ?>
            <option value="<?= data.products[i] ?>"><?= data.products[i] ?></option>
          <? } ?>
        </select>
      </section>
      <section id="offers">
        <font>Select offer type : </font>
        <!-- Append offer type dropdown here -->
      </section>
      <section id="langs">
        <font>Select language : </font>
        <!-- Append language dropdown here -->
      </section>
      <font id="footer">Show my footer</font>
      <br/>
      <font>Footer display</font>
      <section id="footer-display">
      </section>
      <font>Footer source</font>
      <section id="footer-source">
      </section>
    </form>
  </body>
</html>
<!-- Load JS last as per https://developers.google.com/apps-script/guides/html/best-practices -->
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
  $( document ).ready(function() {
    // Hide offer type and language dropdowns on initial loading
    // $("#offer-select").hide();
    // $("#lang-select").hide();
  });
  function showOfferTypes(offerObj) {
    // Client side success handler
    // can only return a string
    // so it must be parsed first
    var offerTypes = JSON.parse(offerObj)[0];
    // Remove existing dropdown
    $("#offers-select").remove();
    // $("#offer-select").show();
    // Create select/dropdown element
    var s = $("<select />", {name: "offerTypes", id : "offers-select"});
    // Add existing offer types
    for(var i in offerTypes) {
      $('<option />', {value: i, text: offerTypes[i]}).appendTo(s);
    }
    // Add the dropdown to the form
    s.appendTo("#offers");
  };
  function showLangs(langObj) {
    // Parse string
    var langs = JSON.parse(langObj);
    // Remove existing dropdown
    $("#langs-select").remove();
    // $("#lang-select").show();
    // Create select/dropdown element
    var s = $("<select />", {name: "langs", id : "langs-select"});
    // Add existing languages
    for(var i in langs) {
      $('<option />', {value: i, text: langs[i][0] + " - " + langs[i][1]}).appendTo(s);
    }
    // Add the dropdown to the form
    s.appendTo("#langs");
  };
  function showFooter(footerObj) {
    // Parse string
    var footer = JSON.parse(footerObj);
    // Display footer content and source
    $("#footer-display").html(footer);
    $("#footer-source").text(footer);
  };
  // Look up offerTypes whenever product is changed
  $("#products-select").change(function() {
    // Hide offer and language dropdowns when product is updated
    $("#offers-select").hide();
    $("#langs-select").hide();
    // Get selected product
    var product = $("#products-select").val();
    // Get offer types for selected product
    google.script.run.withSuccessHandler(showOfferTypes).getOfferTypes(product);
    google.script.run.withSuccessHandler(showLangs).getLangs(product);
  });
  // Look up footer when CTA is clicked
  $("#footer").click(function() {
    // Intialize footer parameter object
    var footerParams = {};
    // Add footer parameters to object
    footerParams.product = $("#products-select").val();
    footerParams.offer = $("#offers-select").val();
    footerParams.lang = $("#langs-select").val();
    // Intialize footer filter options
    footerParams.filters = {};
    // Set smart quote filter to "on" by default
    footerParams.filters.smartQuotes = true;
    // Get footer content using defined parameters
    google.script.run.withSuccessHandler(showFooter).getFooter(footerParams);
  });
</script>